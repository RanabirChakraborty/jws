---
- assert:
    that:
      - tomcat.rpm is defined
      - tomcat.rpm != ""
    quiet: true
    fail_msg: "No RPM package name provided."

- assert:
    that:
      - ansible_os_family == "RedHat"
    quiet: true
    fail_msg: "RPM install can only work on RedHat based distribution."
  when:
    - ansible_os_family is defined

- assert:
    that:
      - tomcat.home is defined
      - tomcat.home == "/opt/rh/jws5/root/usr/share/tomcat/"
    quiet: true
    fail_msg: "Tomcat HOME does not match the one provided by RPM."

- name: "Install {{ tomcat.rpm }}"
  command:
    cmd: "yum group install -y {{ tomcat.rpm }}"
    creates: "{{ tomcat.home }}"

- block:
    - name: "Enable tomcat service"
      service:
        name: jws5-tomcat.service
        enabled: yes

    - name: "start tomcat service"
      service:
        name: jws5-tomcat.service
        state: started
  when:
    - tomcat.service is defined
    - tomcat.service.enabled is defined
    - tomcat.service.enabled
